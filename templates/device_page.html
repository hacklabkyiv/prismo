{% extends "layout.html" %}

{% block content %}

<div class="container-fluid px-md-5">
    <h1 class="my-4">Profile for device : {{ full_device.device.name }}</h1>
    <div>
        <form method="post" action="#">
            <label for="slack_channel_id">Slack ID:</label>
            <input type="text" id="slack_channel_id" name="slack_channel_id" required value={{
                   full_device.device.slack_channel_id }}>

            <input type="submit" value="Set device slack channel id for notification">
        </form>

        <button id="execute-button">Send sent notification</button>
    </div>
    <div class="py-3">
        <div style="width: 100%;">
            <div style="float:left; width: 30%">
                <h4>User with access to {{ full_device.device.name }}</h4>
                <ul>
                    {% for user in full_device.user_with_access %}
                    <li><a href="/user/{{user.key}}">{{ user.name }}</a></li>
                    {% endfor %}
                </ul>
            </div>
            <div style="float:right; width: 70%">
                <table class="table stripe hover align-middle dataTable no-footer compact pt-3">
                    <tr>
                        <th>User name</th>
                        <th>Time</th>
                        <th>Operation</th>
                    </tr>
                    {% for log in full_device.logs %}
                    <tr>
                        <td><a href="/user/{{ log.user.key }}">{{ log.user.name }}</a></td>
                        <td>{{ log.operation.time }}</td>
                        <td>{{ log.operation.type }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <div style="clear:both"></div>
    </div>
</div>

<script>
    $(document).ready(function () {
        let jsonData = {
            device_id: "{{ full_device.device.id }}",
        };
        $('#execute-button').click(function () {
            $.ajax({
                type: 'POST',
                url: '/send-test-message-to-channel',
                data: JSON.stringify(jsonData),
                contentType: 'application/json',
            });
        });
    });
</script>


{% endblock %}
