{% extends "layout.html" %}
{% block content %}
<div class="container-fluid px-md-5">
    <div class="row">
        <div class="form-group col-md-5 col-sm-12" data-step="2">
            <h1 class="my-4">Access control</h1>
        </div>
        <div class="form-group col-md-5 col-sm-12" data-step="3">
            <h1 class="my-4">{{ current_user }}</h1>
        </div>
    </div>

    <div class="well well-sm pb-4" data-step="1"
         data-intro="Latest used key on DOOR is shown here. Put new key to door reader and check modify datetime">Latest
        triggered door key: {{ latest_key }}
    </div>
    <div class="row">
        <div class="form-group col-md-5 col-sm-12" data-step="2" data-intro="Add this new key here.">
            <label for="email">KEY Value: </label>
            <input type="text" class="form-control" id="user_key" value={{ latest_key }}>
        </div>
        <div class="form-group col-md-5 col-sm-12" data-step="3" data-intro="Fill the nickname">
            <label for="pwd">Nickname: </label>
            <input type="text" class="form-control" id="user_name" placeholder="Nickname">
        </div>
        <div class="col-md-2 col-sm-10 d-flex align-items-end">
            <button type="submit" class="btn btn-primary" onclick="addUser()" data-step="4"
                    data-intro="Finish addition">Add user
            </button>
        </div>
    </div>
    <div class="py-3">
        <div class="py-3 table-responsive">
            <table id="tblData" class="table stripe hover align-middle dataTable no-footer compact pt-3">
                <thead>
                <tr>
                    {% for column_name in access_control_panel.header %}
                    <th>{{ column_name }}</th>
                    {% endfor %}
                    <th></th>
                </tr>
                </thead>
                <tbody id="table_body">
                {% for row in access_control_panel.rows %}
                <tr>
                    <td><a href="/user/{{row.user_key}}">{{row.user_name}}</a></td>
                    <td>{{row.user_key}}</td>
                    {% for permission in row.permissions %}
                    <td>
                        <input type="checkbox" name="box1"
                               onChange="onUserPermissionChange('{{row.user_key}}', '{{permission.device_key}}', this)"
                               value="box1" {{ 'checked="checked"' if permission.is_granted else ""}}>
                    </td>
                    {% endfor %}
                    <td>
                        <a class="btn btn-danger btn-sm" onclick="onUserDeleteClick('{{row.user_key}}', this)">
                            <i style="color: white" class="fa fa-trash-o"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
