{% extends "layout.html" %}

{% block content %}
  <div class="container-fluid px-md-5">
    <h1 class="my-4">Settings</h1>

    <div id="settings-container"></div>

    <button id="save-settings-btn" class="btn btn-primary">Save Settings</button>

    <script>
      $(document).ready(function() {
        $.ajax({
          url: "/api/settings",
          method: "GET",
          dataType: "json",
          success: function(settingsData) {
            var settingsContainer = document.getElementById("settings-container");
            for (var key in settingsData) {
              var settingElement = document.createElement("div");
              settingElement.className = "form-group";

              var labelElement = document.createElement("label");
              labelElement.for = key;
              labelElement.textContent = key;
              settingElement.appendChild(labelElement);

              var inputElement = document.createElement("input");
              inputElement.type = "text";
              inputElement.className = "form-control";
              inputElement.id = key;
              inputElement.name = key;
              inputElement.value = settingsData[key];
              settingElement.appendChild(inputElement);

              settingsContainer.appendChild(settingElement);
            }
          },
          error: function(error) {
            console.error("Error fetching settings:", error);
            alert("Error fetching settings. Please try again.");
          }
        });

        $("#save-settings-btn").click(function() {
          var settingsData = {};
          $("#settings-container input").each(function() {
            var key = $(this).attr("name");
            var value = $(this).val();
            settingsData[key] = value;
          });

          $.ajax({
            url: "/api/settings",
            method: "PUT",
            contentType: "application/json",
            data: JSON.stringify(settingsData),
            success: function() {
              alert("Settings updated successfully!");
            },
            error: function(error) {
              console.error("Error updating settings:", error);
              alert("Error updating settings. Please try again.");
            }
          });
        });
      });
    </script>
  </div>
{% endblock %}